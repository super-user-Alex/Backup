import fitz  # PyMuPDF

def items_in_region(page, region_rect):
    items = {"text": [], "images": [], "drawings": [], "annots": []}

    # --- Texto e imágenes (extraer bloques) ---
    # Obtener bloques de tipo texto (0) e imagen (1) en el page
    # Se puede usar flags TEXT_PRESERVE_IMAGES (4) y opcional TEXT_COLLECT_VECTORS (1024) si se quieren vectores aquí.
    blocks = page.get_text("dict", flags=fitz.TEXT_PRESERVE_IMAGES | fitz.TEXT_COLLECT_VECTORS)["blocks"]
    for b in blocks:
        bbox = fitz.Rect(b["bbox"])
        area = bbox.get_area()
        if area <= 0: 
            continue
        inter = bbox & region_rect
        if inter.get_area() / area >= 0.8:
            if b["type"] == 0:
                items["text"].append(b)    # guarda el bloque de texto
            elif b["type"] == 1:
                items["images"].append(b)  # guarda el bloque de imagen

    # --- Dibujos vectoriales ---
    paths = page.get_drawings()
    for path in paths:
        bbox = path["rect"]
        area = bbox.get_area()
        if area <= 0:
            continue
        inter = bbox & region_rect
        if inter.get_area() / area >= 0.8:
            items["drawings"].append(path)

    # --- Anotaciones (PDF) ---
    annot = page.first_annot
    while annot:
        bbox = annot.rect
        area = bbox.get_area()
        if area > 0:
            inter = bbox & region_rect
            if inter.get_area() / area >= 0.8:
                items["annots"].append(annot)
        annot = annot.next

    return items
